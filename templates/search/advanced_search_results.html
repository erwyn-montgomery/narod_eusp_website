{% extends "base.html" %}

{% load static %}
{% load search_extras %}

{% block title %}Результаты расширенного поиска{% endblock %}

{% block extra_css %}<link rel="stylesheet" href="{% static 'css/search/advanced_search_results.css' %}">{% endblock %}

{% block content %}
    <form action="{% url 'advanced_search_results' %}" method="get" class="search-form">
        <div class="search-options">
            <label class="search-label">Поиск среди</label>
            <label class="search-label">
                <input type="radio" name="search_type" value="site" class="search-radio" {% if search_type == 'site' %}checked{% endif %}>
                сайтов
            </label>
            <label class="search-label">
                <input type="radio" name="search_type" value="page" class="search-radio" {% if search_type == 'page' %}checked{% endif %}>
                страниц
            </label>
            <label class="search-label">
                <input type="radio" name="search_type" value="file" class="search-radio" {% if search_type == 'file' %}checked{% endif %}>
                файлов
            </label>
        </div>
        <div class="search-controls">
            <input type="text" name="site_link" placeholder="Поиск по ссылкам на сайт" class="search-input" value="{{ site_link_query }}">
            <input type="text" name="page_text" placeholder="Поиск по тексту и заголовкам страницы" class="search-input" value="{{ page_text_query }}">
            <input type="text" name="file_link" placeholder="Поиск по ссылкам на файл" class="search-input" value="{{ file_link_query }}">
            <label class="file-extension-label">Расширение файла для поиска по по файлам 
                <select name="file_extension" class="search-select">
                    <option value="">Любое</option>
                    {% for extension in file_extensions %}
                        <option value="{{ extension }}" {% if extension == file_extension_query %}selected{% endif %}>{{ extension }}</option>
                    {% endfor %}
                </select>
            </label>
            <input type="submit" value="Поиск" class="search-button">
        </div>
        <div class="entries-dropdown">
            <label for="entries">Элементов на странице:</label>
            <select name="entries" id="entries" onchange="this.form.submit()">
                <option value="20" {% if entries_per_page == '20' %}selected{% endif %}>20</option>
                <option value="40" {% if entries_per_page == '40' %}selected{% endif %}>40</option>
                <option value="60" {% if entries_per_page == '60' %}selected{% endif %}>60</option>
                <option value="80" {% if entries_per_page == '80' %}selected{% endif %}>80</option>
                <option value="100" {% if entries_per_page == '100' %}selected{% endif %}>100</option>
                <option value="200" {% if entries_per_page == '200' %}selected{% endif %}>200</option>
                <option value="500" {% if entries_per_page == '500' %}selected{% endif %}>500</option>
                <option value="1000" {% if entries_per_page == '1000' %}selected{% endif %}>1000</option>
                <option value="10000" {% if entries_per_page == '10000' %}selected{% endif %}>10000</option>
            </select>
        </div>
    </form>
    <h1>Результаты расширенного поиска:</h1>
    {% if page_obj %}
        <div>
            <ul>
                {% for result in page_obj %}
                    {% if result|get_model_name == 'page' %}
                        <li class="result-item">
                            {% if result.site.screenshots.exists %}
                                {% with screenshot=result.site.screenshots.first %}
                                    <a href="{% static screenshot.screenshot_path %}" target="_blank">
                                        <img src="{% static screenshot.screenshot_path %}" alt="Screenshot" style="width: auto; height: 100px; margin-right: 20px;">
                                    </a>
                                {% endwith %}
                            {% else %}
                                <div class="placeholder">    
                                    <img src="{% static 'logo/website-click-svgrepo-com.svg' %}" alt="Screenshot" style="width: auto; height: 100px; margin-right: 20px;">
                                </div>
                            {% endif %}
                            <div class="result-info">
                                <h4><a href="{% static result.page_file %}">{{ result.page_title }}</a></h4>
                                <p>Оригинальная ссылка: <a href="{{ result.page_link }}">{{ result.page_link }}</a></p>
                                {% if result.search_headline %}<p>{{ result.search_headline|safe }}</p>{% endif %}
                            </div>
                        </li>
                    {% elif result|get_model_name == 'site' %}
                        <li class="result-item">
                            {% if result.screenshots.exists %}
                                {% with screenshot=result.screenshots.first %}
                                    <a href="{% static screenshot.screenshot_path %}" target="_blank">
                                        <img src="{% static screenshot.screenshot_path %}" alt="Screenshot" style="width: auto; height: 100px; margin-right: 20px;">
                                    </a>
                                {% endwith %}
                            {% else %}
                                <div class="placeholder">    
                                   <img src="{% static 'logo/website-click-svgrepo-com.svg' %}" alt="Screenshot" style="width: auto; height: 100px; margin-right: 20px;">
                                </div>
                            {% endif %}
                            <div class="result-info">
                                <h4><a href="{% static result.pages.first.page_file %}">{{ result.pages.first.page_title }}</a></h4>
                                <p>Оригинальная ссылка: <a href="{{ result.site_link }}">{{ result.site_link }}</a></p>
                            </div>
                        </li>
                    {% elif result|get_model_name == 'file' %}
                        <li class="result-item">
                            <div class="placeholder">
                                <img src="{% static 'logo/document-svgrepo-com.svg' %}" alt="Screenshot" style="width: auto; height: 100px; margin-right: 20px;">
                            </div>
                            <div class="result-info">
                                <h4><a href="{% static result.file_path %}">{{ result.file_link }}</a></h4>
                                <p>Оригинальная ссылка: <a href="{{ result.file_link }}">{{ result.file_link }}</a></p>
                            </div>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
            <div class="pagination">
                <span class="step-links">
                    {% if page_obj.has_previous %}
                        <a href="?search_type={{ search_type }}&entries={{ entries_per_page }}&site_link={{ site_link_query }}&page_link={{ page_link_query }}&page_title={{ page_title_query }}&page_text={{ page_text_query }}&file_link={{ file_link_query }}&file_extension={{ file_extension_query }}&page=1">&laquo; Первая страница</a>
                        <a href="?search_type={{ search_type }}&entries={{ entries_per_page }}&site_link={{ site_link_query }}&page_link={{ page_link_query }}&page_title={{ page_title_query }}&page_text={{ page_text_query }}&file_link={{ file_link_query }}&file_extension={{ file_extension_query }}&page={{ page_obj.previous_page_number }}">Предыдущая страница</a>
                    {% endif %}
            
                    <span class="current">
                        Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}
                    </span>
            
                    {% if page_obj.has_next %}
                        <a href="?search_type={{ search_type }}&entries={{ entries_per_page }}&site_link={{ site_link_query }}&page_link={{ page_link_query }}&page_title={{ page_title_query }}&page_text={{ page_text_query }}&file_link={{ file_link_query }}&file_extension={{ file_extension_query }}&page={{ page_obj.next_page_number }}">Следующая страница</a>
                        <a href="?search_type={{ search_type }}&entries={{ entries_per_page }}&site_link={{ site_link_query }}&page_link={{ page_link_query }}&page_title={{ page_title_query }}&page_text={{ page_text_query }}&file_link={{ file_link_query }}&file_extension={{ file_extension_query }}&page={{ page_obj.paginator.num_pages }}">Последняя страница &raquo;</a>
                    {% endif %}
                </span>
            </div>
        </div>
    {% endif %}
{% endblock %}